# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°–∏—Å—Ç–µ–º–∞ OCR-OCD —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PDF —Ñ–∞–π–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- **Basename** PDF —Ñ–∞–π–ª–∞ (–∏–º—è –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
- **MD5 —Ö—ç—à** —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤)

**–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ –ø–∞–ø–∫–∏:** `{basename}_{md5_hash_8chars}`

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å**
- –†–∞–∑–Ω—ã–µ PDF —Ñ–∞–π–ª—ã –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–∞–ø–∫–∏
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã (–¥—É–±–ª–∏–∫–∞—Ç—ã) –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ø–∞–ø–∫—É
- –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ

### 2. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**
- –ò–º—è –ø–∞–ø–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Ç–∞–µ–º—É—é —á–∞—Å—Ç—å (–∏–º—è —Ñ–∞–π–ª–∞)
- MD5 —Ö—ç—à –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π —Ñ–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è

### 3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —Å—Ä–µ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PDF
- –ù–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ù–æ–≤—ã–π –º–æ–¥—É–ª—å `src/utils/pdf_utils.py`

```python
def generate_unique_temp_dir(pdf_path: Path, base_temp_dir: Path) -> Path
def calculate_file_md5(file_path: Path) -> str
def get_pdf_unique_identifier(pdf_path: Path) -> str
def cleanup_temp_dir(temp_dir: Path, keep_processed_files: bool) -> None
def validate_pdf_file(pdf_path: Path) -> bool
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `src/main.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Å–µ `OCROCDOrchestrator`:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `unique_temp_dir: Optional[Path]`
- –ú–µ—Ç–æ–¥ `setup_components()` —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É
- –ú–µ—Ç–æ–¥ `cleanup()` –æ—á–∏—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è PDF –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

### 3. Comprehensive —Ç–µ—Å—Ç—ã `tests/unit/test_pdf_utils.py`

**17 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç:**
- ‚úÖ –†–∞—Å—á–µ—Ç MD5 —Ö—ç—à–µ–π
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—é PDF —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û—á–∏—Å—Ç–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
temp/
‚îú‚îÄ‚îÄ page_001.png
‚îú‚îÄ‚îÄ page_002.png
‚îú‚îÄ‚îÄ processing_state.json
‚îî‚îÄ‚îÄ ... (—Ñ–∞–π–ª—ã —Ä–∞–∑–Ω—ã—Ö PDF —Å–º–µ—à–∞–Ω—ã)
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
temp/
‚îú‚îÄ‚îÄ textbook_chapter1_a1b2c3d4/
‚îÇ   ‚îú‚îÄ‚îÄ page_001.png
‚îÇ   ‚îú‚îÄ‚îÄ page_001.json
‚îÇ   ‚îî‚îÄ‚îÄ processing_state.json
‚îú‚îÄ‚îÄ textbook_chapter2_e5f6g7h8/
‚îÇ   ‚îú‚îÄ‚îÄ page_001.png
‚îÇ   ‚îú‚îÄ‚îÄ page_001.json
‚îÇ   ‚îî‚îÄ‚îÄ processing_state.json
‚îî‚îÄ‚îÄ homework_exercises_i9j0k1l2/
    ‚îú‚îÄ‚îÄ page_001.png
    ‚îú‚îÄ‚îÄ page_001.json
    ‚îî‚îÄ‚îÄ processing_state.json
```

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ):
```bash
python -m src.main textbook.pdf tasks.csv
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–∞–ø–∫–∞ `temp/textbook_a1b2c3d4/`

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
```bash
python -m src.main chapter1.pdf chapter1_tasks.csv &
python -m src.main chapter2.pdf chapter2_tasks.csv &
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `temp/chapter1_e5f6g7h8/` –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞
- `temp/chapter2_i9j0k1l2/` –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
```bash
python -m src.main textbook.pdf tasks1.csv
python -m src.main textbook_copy.pdf tasks2.csv  # –ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ø–∞–ø–∫—É (–µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ)

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `temp_dir` –∏–∑ `config.py`:

```python
class Config(BaseModel):
    temp_dir: Path = Field(default=Path("temp"))
```

–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `temp_dir`:
- –ë–∞–∑–æ–≤–∞—è –ø–∞–ø–∫–∞: `temp/`
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏: `temp/{basename}_{md5_hash}/`

## üßπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
```python
orchestrator.cleanup()  # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç JSON —Ñ–∞–π–ª—ã, —É–¥–∞–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

### –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:
```python
from src.utils.pdf_utils import cleanup_temp_dir

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
cleanup_temp_dir(temp_dir, keep_processed_files=False)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON —Ñ–∞–π–ª—ã
cleanup_temp_dir(temp_dir, keep_processed_files=True)
```

## üîí –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–ª–∞—Å—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
python -m pytest tests/unit/test_pdf_utils.py -v

# –†–µ–∑—É–ª—å—Ç–∞—Ç: 17 passed ‚úÖ
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- **MD5 –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:** 3 —Ç–µ—Å—Ç–∞
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞–ø–æ–∫:** 3 —Ç–µ—Å—Ç–∞  
- **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤:** 2 —Ç–µ—Å—Ç–∞
- **–û—á–∏—Å—Ç–∫–∞ –ø–∞–ø–æ–∫:** 3 —Ç–µ—Å—Ç–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è PDF:** 5 —Ç–µ—Å—Ç–æ–≤
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:** 1 —Ç–µ—Å—Ç

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ OCR-OCD —Ç–µ–ø–µ—Ä—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** –∫–∞–∂–¥–æ–≥–æ PDF —Ñ–∞–π–ª–∞
2. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ  
3. **–ß–∏—Ç–∞–µ–º—ã–µ –∏–º–µ–Ω–∞** –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É** —Å –≥–∏–±–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
5. **–ü–æ–ª–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

**–ì–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ 